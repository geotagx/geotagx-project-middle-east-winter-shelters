<style>
@import url("http://fonts.googleapis.com/css?family=Lato|Montserrat|Open+Sans|Patua+One|Martel+Sans|Noto+Sans");

input[type="radio"],
input[type="checkbox"]
{
    margin:0.1em 0.25em 0 0;
}


.show-on-task-loaded
{
    display:none !important;
}


.question
{
    margin:0 0 1.5em 0;
}
    .question > header
    {
        /*margin:0 0 0.25em 0;*/
        font:400 1.85em Patua One;
        margin:0.1em 0;
    }

.btn
{
    font-family:Montserrat;
    text-transform:uppercase;
    border-radius:2px;
}
.answer
{
    margin-top:1em;
}


.help-toggle
{
    margin:0;
    padding:0;
    cursor:help;
}


.illustration-img
{
    border-radius:2px 2px 0 0;
    width:100%;
    height:7em;
    cursor:zoom-in;
}
.illustration-label
{
    border-radius:0 0 2px 2px;
    text-transform:uppercase;
    width:100%;
    cursor:pointer;
}
.illustration-input
{
    margin:0.25em 0 0.75em 0;
}

#content-main
{
    font:400 1em Martel Sans, Open Sans, Lato;
}

#content
{
}
    #content-header
    {
        padding:1em 0;
        /*text-align:center;*/
    }
        #questionnaire-topic
        {
            font:900 2.6em Montserrat, Open Sans !important;

            text-transform:uppercase;
            /*margin:0;*/
            /*background:red;*/
        }






#questionnaire-section
{

}
    #questionnaire-summary
    {
        position:relative;
        background:#333;
        color:#FFF;
        border-radius:0.3em;
        overflow:hidden;
        margin:0 0 0.5em 0;
        /*font:400 0.8em Open Sans, Lato;*/


        /*padding:0 0.5em 0.5em 0.5em;*/
        /*padding:0.75em;*/
        /*margin-bottom:1em;*/
        /*margin:1em 0;*/
        /*background:red;*/

    }
        #questionnaire-summary > header
        {
            font:400 1em Montserrat;
            text-transform:uppercase;
        }
            #questionnaire-summary.minimized #questionnaire-submit,
            #questionnaire-summary.minimized #questionnaire-conclusion
            {
                display:none;
            }
            #questionnaire-summary-details
            {
                color:#AAA;
                margin:0;
                padding:0;
                border:none;
                font:900 1em Montserrat;
                text-transform:uppercase;
                text-decoration:none;
                transition:color 0.1s ease-in-out;
                -o-transition:color 0.1s ease-in-out;
                -ms-transition:color 0.1s ease-in-out;
                -moz-transition:color 0.1s ease-in-out;
                -webkit-transition:color 0.1s ease-in-out;
            }
            #questionnaire-summary-details:hover
            {
                color:#FFF;
            }
            #questionnaire-summary-details:focus
            {
                outline:0 none;
            }
            #questionnaire-summary-details[aria-expanded="true"]  .hide-on-expanded,
            #questionnaire-summary-details[aria-expanded="false"] .show-on-expanded
            {
                display:none;
            }
        #questionnaire-summary > ul > li
        {
            /*font:400 1em Montserrat;*/
            font:400 1.1em Noto Sans, Open Sans, Lato;
        }
        #questionnaire-submit
        {
            color:#000;
            border-radius:2px;
            margin-top:0.75em;
        }
        #questionnaire-progress-bar
        {
            position:absolute;
            left:0;
            bottom:0;
            width:0;
            height:0.25em;
            background:#66FFCC;
            transition:all 0.2s ease-in;
            -o-transition:all 0.2s ease-in;
            -ms-transition:all 0.2s ease-in;
            -moz-transition:all 0.2s ease-in;
            -webkit-transition:all 0.2s ease-in;
        }

    #questionnaire-rewind
    {
        margin-bottom:1em;
    }
    #questionnaire-rewind:disabled
    {
        display:none !important;
    }

#image-section
{
}
    #image-loading
    {
        position:absolute;
        font:900 3em Montserrat;
        text-transform:uppercase;
        cursor:wait;
    }
    #image
    {
        cursor:crosshair;
        border-radius:0.2em;
        border:1px dashed rgba(0, 0, 0, 0.15);
    }
    #image-source-container
    {
        margin:0.5em 0;
        font:400 1.1em Open Sans, Lato;
    }
    #image-zoomtip
    {
        font:900 1em Lato, Open Sans;
    }
#ol-map
{
    position:relative;
    width:100%;
    height:400px;
    border:1px dashed rgba(0, 0, 0, 0.3);
    border-radius:2px;
    margin-bottom:0.5em !important;
}
#ol-map-search
{
    position:relative;
    height:2.5em;
    margin:0 0 0.25em 0;
}
    #ol-map-search-input
    {
        padding-right:5em;
    }
    #ol-map-search-button
    {
        position:absolute;
        right:0;
        bottom:0.4em;
        width:5em;
        height:2em;
        margin:0.5em 0.4em;
        border-radius:0 3px 3px 0;
        background:rgb(52, 73, 94);
        color:#FFF;
        transition:all ease-in-out 0.3s;
        o-transition:all ease-in-out 0.3s;
        ms-transition:all ease-in-out 0.3s;
        moz-transition:all ease-in-out 0.3s;
        webkit-transition:all ease-in-out 0.3s;
    }
        #ol-map-search-button > i.fa
        {
            font-size:1.3em;
        }

		.help_popup_description
		{
			display:none;
		}
		.question
		{
			display:none;
		}
</style>
<div class="row">
    <section id="questionnaire-section" class="col-xs-6">
        <div id="step_0" class="question">
            <h1>Can you see shelter in the photo?</h1>
			<div class="row help_popup col-xs-12">
			<i class="fa fa-exclamation-circle"></i> How do I answer this question? <a class="help_popup_a" href="javascript:void(0)">Get some help</a>
				<div class="help_popup_description col-xs-12">
					<p>This is a filtering question to remove any photos that do not have shelter in them and therefore are not relevant to this analysis. <strong>For the purposes of this project, shelter refers to tents</strong></p>
					<p>Click “Yes” is you see any shelter in the photo. </p>
					<p>Click “No” if you do not see any shelter. This would include more permanent structures like demountable buildings and permanent buildings. If you are unsure if something is shelter, "don't know" is a valid and useful answer.</p>
					<p>Here are some examples for which you would click "Yes":
					<div class="row">
						<div class="col-sm-6">
							<a target="_blank" href="https://farm8.staticflickr.com/7419/16208614030_6d3b70b7a3_b.jpg"><img style="width:500px;" src="https://farm8.staticflickr.com/7419/16208614030_6d3b70b7a3_b.jpg" class="img-thumbnail"></a>
							<p style="font-size:10px;"><span class="fa fa-picture"></i><a href="https://www.flickr.com/photos/130225227@N02/sets/72157650545270972/" target="_blank" style="font-size:10px;"><span class="fa fa-picture"></i>REACH</a></p>
						</div>
						<div class="col-sm-6">
							<a target="_blank" href="https://farm8.staticflickr.com/7408/16396037175_b9aeda4b9a_b.jpg"><img style="width:500px;" src="https://farm8.staticflickr.com/7408/16396037175_b9aeda4b9a_b.jpg" class="img-thumbnail"></a>
							<p style="font-size:10px;"><span class="fa fa-picture"></i> <a target="_blank" href="https://www.flickr.com/photos/130225227@N02/sets/72157650545270972/">REACH</a></p>
						</div>
					</div>
					<p>And some for which you would click "No":
					<div class="row">
						<div class="col-sm-6">
							<a target="_blank" href="https://farm9.staticflickr.com/8207/8264100892_26dfbab470_n.jpg"><img style="width:500px;" src="https://farm9.staticflickr.com/8207/8264100892_26dfbab470_n.jpg" class="img-thumbnail"></a>
							<p style="font-size:10px;"><span class="fa fa-picture"></i><a href="https://www.flickr.com/photos/25857074@N03/sets/72157632218402821/" target="_blank" style="font-size:10px;"><span class="fa fa-picture"></i>UNHCR</a></p>
						</div>
						<div class="col-sm-6">
							<a target="_blank" href="https://farm9.staticflickr.com/8201/8264101046_d56317b098_n.jpg"><img style="width:500px;" src="https://farm9.staticflickr.com/8201/8264101046_d56317b098_n.jpg" class="img-thumbnail"></a>
							<p style="font-size:10px;"><span class="fa fa-picture"></i> <a target="_blank" href="https://www.flickr.com/photos/25857074@N03/sets/72157632218402821/">UNHCR</a></p>
						</div>
					</div>
					</div>
			</div>

			<p>&nbsp;</p>
            <div id="answer" class="row col-xs-12"> <!-- Start DIV for the submission buttons -->
                <!-- If the user clicks this button, the saved answer will be value="yes"-->
                <button class="step_0 answer_yes btn btn-success btn-answer" value='Yes'><i class="fa fa-white fa-thumbs-up"></i> Yes</button>
                <!-- If the user clicks this button, the saved answer will be value="no"-->
                <button class="step_0 answer_no btn btn-danger btn-answer" value='No'><i class="fa fa-white fa-thumbs-down"></i> No</button>
                <!-- If the user clicks this button, the saved answer will be value="NoPhoto"-->
                <button class="step_0 answer_unknown btn btn-answer" value='Unknown'><i class="fa fa-white fa-question-sign"></i> I don't know</button>
				<div class="answer_popup">
					<div class="answer_yes_popup">
						<div class="alert  alert-success">

						 <strong>Well done!</strong>There is shelter in this photo<a id="" href="#" onclick="javascript:load_tutorial_step(1);" class="btn btn-primary">Next</a>
						</div>
					</div>
					<div class="answer_no_popup">
						<div class="alert  alert-danger">

						  <strong>Have another look.</strong> Are you sure there is no shelter in this photo?
						</div>
					</div>
					<div class="answer_unknown_popup">
						<div class="alert  alert-danger">

						  <strong>Have another look.</strong> If you are not sure what to look for, click on "Get some help"
						</div>
					</div>
				</div>
            </div><!-- End of DIV for the submission buttons -->
        </div>
        <!-- End Step 0 -->

		 <!-- Step 1-->
        <div id="step_1" class="question">
           <h1>Is the shelter raised off the ground?</h1>
			<div class="row help_popup col-xs-12">
			<i class="fa fa-exclamation-circle"></i> How do I answer this question? <a class="help_popup_a" href="javascript:void(0)">Get some help</a>
				<div class="help_popup_description col-xs-12">
					<p>This analysis is about whether shelter has a plinth or layer underneath that raises it off the ground. This gives the shelter some protection against flooding. Click “Yes” if the shelter is raised from the ground, either by a wood or concrete layer or raised earth. Click “No” if the shelter is clearly not raised off the ground. If you are unsure, "don't know" is the best answer.</p>
					<div class="row">
						<div class="col-sm-6">
							<a target="_blank" href="http://cern.ch/unosat-sdn/ellie/Plinth1.png"><img style="width:500px;" src="http://cern.ch/unosat-sdn/ellie/Plinth1.png" class="img-thumbnail"></a>
							<p style="font-size:10px;"><span class="fa fa-picture"></i><a href="http://www.stripes.com/refugees-in-jordan-welcome-possible-strike-against-syrian-regime-1.238336" target="_blank" style="font-size:10px;"><span class="fa fa-picture"></i>Stars and Stripes</a></p>
						</div>
						<div class="col-sm-6">
							<a target="_blank" href="http://cern.ch/unosat-sdn/ellie/Plinth2.png"><img style="width:500px;" src="http://cern.ch/unosat-sdn/ellie/Plinth2.png" class="img-thumbnail"></a>
							<p style="font-size:10px;"><span class="fa fa-picture"></i> <a target="_blank" href="https://www.flickr.com/photos/unhcr/3610080741/in/photolist-73EsL4-qvquNX-4bGb2K-6v1Bep-dkQes4-6yCymQ-7ADvJN-peLYCR-5rW57S-nywZAF-a9CU2s-51giX4-51kut1-bX1c1z-51gibc-51gj64-dArYDn-joi61f-51ku6f-7xiRzn-oipVPq-b2GUpa-8aBopN-9MLwHF-oxdA8w-bxzXPL-7ohtXo-oqCwPR-nAxnmu-oyazPU-dxfQ2h-nJuFmP-oPr9dr-hW7Tpc-7SSPrH-9MPz1s-nQAptN-hyFbJm-6FhrC5-hGpesF-8xrdXK-51giQM-6RkfrC-fF34uU-bxvbFV-eLiYEu-5N79zE-ifqC9u-jfsAR8-aiuEFD/">UNHCR</a></p>
						</div>

					</div>
				</div>
			</div>

			<p>&nbsp;</p>
            <div id="answer" class="row col-xs-12"> <!-- Start DIV for the submission buttons -->
                <!-- If the user clicks this button, the saved answer will be value="yes"-->
                <button class="step_1 answer_yes btn btn-success btn-answer" value='Yes'><i class="fa fa-white fa-thumbs-up"></i> Yes</button>
                <!-- If the user clicks this button, the saved answer will be value="no"-->
                <button class="step_1 answer_no btn btn-danger btn-answer" value='No'><i class="fa fa-white fa-thumbs-down"></i> No</button>
                <!-- If the user clicks this button, the saved answer will be value="NoPhoto"-->
                <button class="step_1 answer_unknown btn btn-answer" value='Unknown'><i class="fa fa-white fa-question-sign"></i> I don't know</button>
				<div class="answer_popup">
					<div class="answer_yes_popup">
						<div class="alert  alert-success">

						 <strong>Well done!</strong>There does appear to be a layer of raised earth below these tents. <a id="" href="#" onclick="javascript:load_tutorial_step(2);" class="btn btn-primary">Next</a>
						</div>
					</div>
					<div class="answer_no_popup">
						<div class="alert  alert-danger">

						  <strong>Have another look.</strong> Can you see raised earth under the edges of the tent?
						</div>
					</div>
					<div class="answer_unknown_popup">
						<div class="alert  alert-danger">
						  <strong>Have another look.</strong> If you are not sure what to look for, click on "Get some help"
						</div>
					</div>
				</div>
            </div><!-- End of DIV for the submission buttons -->
        </div>
        <!-- End Step 1 -->

			 <!-- Step 2-->
        <div id="step_2" class="question">
            <h1>Does the shelter have a second cover to protect it from the rain?</h1>

			<div class="row help_popup col-xs-12">
			<i class="fa fa-exclamation-circle"></i> How do I answer this question? <a class="help_popup_a" href="javascript:void(0)">Get some help</a>
				<div class="help_popup_description col-xs-12">
					<p>This analysis is about whether shelter has a second cover on top, called a fly sheet, which protects against rain or snow. Click “Yes” if you can see a second layer on top of the covering of the shelter. Click “No” if the shelter appears to have only one layer. If you are unsure, "don't know" is the best answer.</p>
					<div class="row">
						<div class="col-sm-6">
							<a target="_blank" href="http://cern.ch/unosat-sdn/ellie/Rain1.png"><img style="width:500px;" src="http://cern.ch/unosat-sdn/ellie/Rain1.png" class="img-thumbnail"></a>
							<p style="font-size:10px;"><span class="fa fa-picture"></i><a target="_blank" href="http://img.static.reliefweb.int/sites/reliefweb.int/files/styles/report-large/public/report-images/download_30.jpeg?itok=6YjhC7Pt" style="font-size:10px;"><span class="fa fa-picture"></i>ReliefWeb</a></p>
						</div>
						<div class="col-sm-6">
							<a target="_blank" href="http://cern.ch/unosat-sdn/ellie/Rain2.png"><img style="width:500px;" src="http://cern.ch/unosat-sdn/ellie/Rain2.png" class="img-thumbnail"></a>
							<p style="font-size:10px;"><span class="fa fa-picture"></i> <a target="_blank" href="https://www.flickr.com/photos/oxfam/5571660838">Oxfam</a></p>
						</div>
					</div>
				</div>
			</div>

			<p>&nbsp;</p>
            <div id="answer" class="row col-xs-12"> <!-- Start DIV for the submission buttons -->
                <!-- If the user clicks this button, the saved answer will be value="yes"-->
                <button class="step_2 answer_yes btn btn-success btn-answer" value='Yes'><i class="fa fa-white fa-thumbs-up"></i> Yes</button>
                <!-- If the user clicks this button, the saved answer will be value="no"-->
                <button class="step_2 answer_no btn btn-danger btn-answer" value='No'><i class="fa fa-white fa-thumbs-down"></i> No</button>
                <!-- If the user clicks this button, the saved answer will be value="NoPhoto"-->
                <button class="step_2 answer_unknown btn btn-answer" value='Unknown'><i class="fa fa-white fa-question-sign"></i> I don't know</button>
				<div class="answer_popup">
					<div class="answer_yes_popup">
						<div class="alert  alert-success">

						 <strong>Well done!</strong> There is a second cover, called a fly sheet, on these tents. <a id="" href="#" onclick="javascript:load_tutorial_step(3);" class="btn btn-primary">Next</a>
						</div>
					</div>
					<div class="answer_no_popup">
						<div class="alert  alert-danger">

						  <strong>Have another look.</strong> Are you sure there is no second cover on the tent to protect from rain?
						</div>
					</div>
					<div class="answer_unknown_popup">
						<div class="alert  alert-danger">

						  <strong>Have another look.</strong> If you are not sure what to look for, click on "Get some help"
						</div>
					</div>
				</div>
            </div><!-- End of DIV for the submission buttons -->
        </div>
        <!-- End Step 2 -->

		<!-- Step 3-->
        <div id="step_3" class="question">
            <h1>Is there space to put a chimney safely inside the shelter?</h1>

			<div class="row help_popup col-xs-12">
			<i class="fa fa-exclamation-circle"></i> How do I answer this question? <a class="help_popup_a" href="javascript:void(0)">Get some help</a>
				<div class="help_popup_description col-xs-12">
					<p>To safely use a stove inside a shelter, there needs to be a chimney or space to put one without burning down the shelter or people inside inhaling smoke. Click “Yes” if the shelter already has a chimney or if it has a metal plate to put a chimney pipe. Click “No” if there would be no space to install a chimney safely. If you are unsure, "don't know" is the best answer.</p>
					<div class="row">
						<div class="col-sm-6">
							<a target="_blank" href="http://cern.ch/unosat-sdn/ellie/Chimney1.png"><img style="width:500px;" src="http://cern.ch/unosat-sdn/ellie/Chimney1.png" class="img-thumbnail"></a>
							<p style="font-size:10px;"><span class="fa fa-picture"></i><a target="_blank" href="http://s234.photobucket.com/user/whelenpg/media/huntingsept2009058.jpg.html" style="font-size:10px;"><span class="fa fa-picture"></i>whelenpg</a></p>
						</div>
						<div class="col-sm-6">
							<a target="_blank" href="http://cern.ch/unosat-sdn/ellie/Chimney2.png"><img style="width:500px;" src="http://cern.ch/unosat-sdn/ellie/Chimney2.png" class="img-thumbnail"></a>
							<p style="font-size:10px;"><span class="fa fa-picture"></i> <a target="_blank" href="http://i02.i.aliimg.com/img/pb/352/208/251/1274947623972_hz-myalibaba-web5_6139.jpg">Alibaba.com</a></p>
						</div>
					</div>
				</div>
			</div>

			<p>&nbsp;</p>
            <div id="answer" class="row col-xs-12"> <!-- Start DIV for the submission buttons -->
                <!-- If the user clicks this button, the saved answer will be value="yes"-->
                <button class="step_3 answer_yes btn btn-success btn-answer" value='Yes'><i class="fa fa-white fa-thumbs-up"></i> Yes</button>
                <!-- If the user clicks this button, the saved answer will be value="no"-->
                <button class="step_3 answer_no btn btn-danger btn-answer" value='No'><i class="fa fa-white fa-thumbs-down"></i> No</button>
                <!-- If the user clicks this button, the saved answer will be value="NoPhoto"-->
                <button class="step_3 answer_unknown btn btn-answer" value='Unknown'><i class="fa fa-white fa-question-sign"></i> I don't know</button>
				<div class="answer_popup">
					<div class="answer_yes_popup">
						<div class="alert  alert-danger">

						 <strong>Have another look.</strong> Are you sure you could put a chimney on this tent right now? If you're not sure, 'I don't know' is always a valid and valuable answer.
						</div>
					</div>
					<div class="answer_no_popup">
						<div class="alert  alert-danger">

						  <strong>Have another look.</strong> It doesn't appear that this tent is set up to build a safe chimney inside. However we can't see the other sides of the tent very well so it is difficult to say if there is place for a chimney or not. 'I don't know' would be a more appropriate answer here.
						</div>
					</div>
					<div class="answer_unknown_popup">
						<div class="alert  alert-success">

						  <strong>Well done!</strong> It doesn't appear that this tent is set up to build a safe chimney inside, but we can't see the other sides of the tent very well. 'I don't know' if a good answer, especially if you've clicked on "Get some help" for more information and are still not sure. <a id="" href="#" onclick="javascript:load_tutorial_step(4);" class="btn btn-primary">Next</a>
						</div>
					</div>
				</div>
            </div><!-- End of DIV for the submission buttons -->
        </div>
        <!-- End Step 3 -->

		<div id="step_4" class="question">
			<h2>Well done!</h2>
			<h3>You have successfully completed the tutorial!</h3>
			<p>You are now ready to begin work on the application.<br>You can<button id="restart-tutorial" class="btn-link"><strong>repeat the tutorial</strong></button>as many times as you want!</p>
		</div>
	</section>
	<section id="image-section" class="col-xs-6">
	    <div class="row">
			<center>
				<img id="image" class="highlight wheelzoom img-responsive show-on-task-loaded" src="https://farm6.staticflickr.com/5062/5571660838_720c2c0b38_b.jpg">
				<div id="image-zoomtip" class="show-on-task-loaded">Hover your mouse over the image and use the scroll wheel to zoom in and out.</div>
				<div id="image-source-container" class="show-on-task-loaded"><strong>You can learn more about this photo by visiting its <a id="image-source" rel="nofollow" target="_blank" href="https://www.flickr.com/photos/oxfam/5571660838">source</a>.<strong></div>
			</center>
	    </div>
	</section>
	<div class="navigation col-xs-12">
		<a id="prevBtn" href="#" onclick="javascript:void(0);" style="display:none;" class="btn">Previous</a>
	</div>
</div>
<script>
var $current = null;
var $rewind = null;
var numberOfSteps = 0;

$(document).ready(function(){
	$rewind = $("#prevBtn");
	numberOfSteps = $(".question").length - 1;

	wheelzoom($("#image"));
	$("*[data-toggle=tooltip]").tooltip();

	$(".help_popup_a").click(function(event){
		event.preventDefault();
		$(".help_popup_description",$(this).parent()).toggle();
		if($(".help_popup_description",$(this).parent()).css("display")=="block"){
			$(this).html("Hide the help!");
		}
		else
			$(this).html("Get some help");
	});

	// Start a tutorial.
	function start(){
		$(".question").hide();
		reset_answer_popup();
		$current = $("#step_0");
		$current.show();
	}

	function reset_answer_popup(){
		$(".answer_yes_popup").hide();
		$(".answer_no_popup").hide();
		$(".answer_unknown_popup").hide();
	}

	$(".answer_yes").click(function(){
		reset_answer_popup();
		$(".answer_yes_popup",$current).show();
	});
	$(".answer_no").click(function(){
		reset_answer_popup();
		$(".answer_no_popup",$current).show();
	});
	$(".answer_unknown").click(function(){
		reset_answer_popup();
		$(".answer_unknown_popup",$current).show();
	});

	$(".show-on-task-loaded").removeClass("show-on-task-loaded");

	// Set the previous button event handler.
	$rewind.click(function(){
		var currentId = $current.attr("id");
		var previous  = parseInt(currentId[currentId.length - 1]) - 1;

		load_tutorial_step(previous);
	});

	$("#restart-tutorial").on("click", start);

	start();
});


function load_tutorial_step(number){
	$(".question").hide();

	var stepId = "#step_" + number;

	$current = $(stepId);
	$current.show();

	if(number > 0)
 		$rewind.removeClass("hide");
	else
		$rewind.addClass("hide");
}
</script>
<script>
/*!
	Wheelzoom 3.0.0
	license: MIT
	http://www.jacklmoore.com/wheelzoom
*/
window.wheelzoom = (function(){
	var defaults = {
		zoom: 0.10
	};
	var canvas = document.createElement('canvas');

	function setSrcToBackground(img) {
		img.style.backgroundImage = "url('"+img.src+"')";
		img.style.backgroundRepeat = 'no-repeat';
		canvas.width = img.naturalWidth;
		canvas.height = img.naturalHeight;
		img.src = canvas.toDataURL();
	}

	main = function(img, options){
		if (!img || !img.nodeName || img.nodeName !== 'IMG') { return; }

		var settings = {};
		var width;
		var height;
		var bgWidth;
		var bgHeight;
		var bgPosX;
		var bgPosY;
		var previousEvent;

		function updateBgStyle() {
			if (bgPosX > 0) {
				bgPosX = 0;
			} else if (bgPosX < width - bgWidth) {
				bgPosX = width - bgWidth;
			}

			if (bgPosY > 0) {
				bgPosY = 0;
			} else if (bgPosY < height - bgHeight) {
				bgPosY = height - bgHeight;
			}

			img.style.backgroundSize = bgWidth+'px '+bgHeight+'px';
			img.style.backgroundPosition = bgPosX+'px '+bgPosY+'px';
		}

		function reset() {
			bgWidth = width;
			bgHeight = height;
			bgPosX = bgPosY = 0;
			updateBgStyle();
		}

		function onwheel(e) {
			var deltaY = 0;

			e.preventDefault();

			if (e.deltaY) { // FireFox 17+ (IE9+, Chrome 31+?)
				deltaY = e.deltaY;
			} else if (e.wheelDelta) {
				deltaY = -e.wheelDelta;
			}

			// As far as I know, there is no good cross-browser way to get the cursor position relative to the event target.
			// We have to calculate the target element's position relative to the document, and subtrack that from the
			// cursor's position relative to the document.
			var rect = img.getBoundingClientRect();
			var offsetX = e.pageX - rect.left - document.body.scrollLeft;
			var offsetY = e.pageY - rect.top - document.body.scrollTop;

			// Record the offset between the bg edge and cursor:
			var bgCursorX = offsetX - bgPosX;
			var bgCursorY = offsetY - bgPosY;

			// Use the previous offset to get the percent offset between the bg edge and cursor:
			var bgRatioX = bgCursorX/bgWidth;
			var bgRatioY = bgCursorY/bgHeight;

			// Update the bg size:
			if (deltaY < 0) {
				bgWidth += bgWidth*settings.zoom;
				bgHeight += bgHeight*settings.zoom;
			} else {
				bgWidth -= bgWidth*settings.zoom;
				bgHeight -= bgHeight*settings.zoom;
			}

			// Take the percent offset and apply it to the new size:
			bgPosX = offsetX - (bgWidth * bgRatioX);
			bgPosY = offsetY - (bgHeight * bgRatioY);

			// Prevent zooming out beyond the starting size
			if (bgWidth <= width || bgHeight <= height) {
				reset();
			} else {
				updateBgStyle();
			}
		}

		function drag(e) {
			e.preventDefault();
			bgPosX += (e.pageX - previousEvent.pageX);
			bgPosY += (e.pageY - previousEvent.pageY);
			previousEvent = e;
			updateBgStyle();
		}

		function removeDrag() {
			document.removeEventListener('mouseup', removeDrag);
			document.removeEventListener('mousemove', drag);
		}

		// Make the background draggable
		function draggable(e) {
			e.preventDefault();
			previousEvent = e;
			document.addEventListener('mousemove', drag);
			document.addEventListener('mouseup', removeDrag);
		}

		function loaded() {
			var computedStyle = window.getComputedStyle(img, null);

			width = parseInt(computedStyle.width, 10);
			height = parseInt(computedStyle.height, 10);
			bgWidth = width;
			bgHeight = height;
			bgPosX = 0;
			bgPosY = 0;

			setSrcToBackground(img);

			img.style.backgroundSize =  width+'px '+height+'px';
			img.style.backgroundPosition = '0 0';
			img.addEventListener('wheelzoom.reset', reset);

			img.addEventListener('wheel', onwheel);
			img.addEventListener('mousedown', draggable);
		}

		img.addEventListener('wheelzoom.destroy', function (originalProperties) {
			console.log(originalProperties);
			img.removeEventListener('wheelzoom.destroy');
			img.removeEventListener('wheelzoom.reset', reset);
			img.removeEventListener('load', onload);
			img.removeEventListener('mouseup', removeDrag);
			img.removeEventListener('mousemove', drag);
			img.removeEventListener('mousedown', draggable);
			img.removeEventListener('wheel', onwheel);

			img.style.backgroundImage = originalProperties.backgroundImage;
			img.style.backgroundRepeat = originalProperties.backgroundRepeat;
			img.src = originalProperties.src;
		}.bind(null, {
			backgroundImage: img.style.backgroundImage,
			backgroundRepeat: img.style.backgroundRepeat,
			src: img.src
		}));

		options = options || {};

		Object.keys(defaults).forEach(function(key){
			settings[key] = options[key] !== undefined ? options[key] : defaults[key];
		});

		if (img.complete) {
			loaded();
		} else {
			function onload() {
				img.removeEventListener('load', onload);
				loaded();
			}
			img.addEventListener('load', onload);
		}
	};

	// Do nothing in IE8
	if (typeof window.getComputedStyle !== 'function') {
		return function(elements) {
			return elements;
		}
	} else {
		return function(elements, options) {
			if (elements && elements.length) {
				Array.prototype.forEach.call(elements, main, options);
			} else if (elements && elements.nodeName) {
				main(elements, options);
			}
			return elements;
		}
	}
}());
</script>
